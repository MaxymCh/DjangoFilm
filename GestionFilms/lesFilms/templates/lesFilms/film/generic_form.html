{% extends "lesFilms/base.html" %}
{% block title %}{{ action_name }} {{class_name }}{% endblock %}

{% load static %}
{% block style %}<link rel="stylesheet" href="{% static 'css/style_form_film.css' %}" />{% endblock %}

{% block content %}
<form method="post" class="post-form">
  {% csrf_token %}
  <div class="container container-form">
    <br />
    <div class="form-group row">
      <label class="col-sm-1 col-form-label"></label>
      <div class="col-sm-4">
        <h3>{{ action_description }} {{ class_name }}</h3>
      </div>
    </div>
    {{ form.as_p }}
    <div id="creation-acteur">

    </div>
    <button type="button" class="btn btn-success" id="btn-add-acteur">Ajouter Acteur</button>
    <a href="#" data-bs-toggle="modal"
    data-bs-target="#createRealisateurModal" class="open-createModal">Crée Realisateur
    </a>

    <div class="form-group row">
      <label class="col-sm-1 col-form-label"></label>
      <div class="col-sm-4">
        <button type="submit" class="btn btn-success">Valider</button>
      </div>
    </div>
  </div>
</form>

<div
  class="modal fade"
  id="createRealisateurModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Création de Realisteur
        </h5>
        <button type="button"  class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="input-realisateur-prenom">Prenom</label>
          <input type="text" class="form-control" id="input-realisateur-prenom">
        </div>
        <div class="form-group">
          <label for="input-realisateur-nom">Nom</label>
          <input type="text" class="form-control" id="input-realisateur-nom">
        </div>
      </div>
      <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal">Annuler
          </button>
          <button type="button" class="btn btn-success" id="btn-create-realisateur">Crée</button>
      </div>
    </div>
  </div>
</div>  

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let numberActeurAdd = 0;
    const buttonAddActeur = document.getElementById(
      "btn-add-acteur"
    );
    buttonAddActeur.addEventListener("click", function (e) {
      divCreateActeur = document.getElementById("creation-acteur");
      let divFormGroup = document.createElement("div");
      divFormGroup.className = "form-group";

      createInputPerso("prenom", divFormGroup, numberActeurAdd)
      createInputPerso("nom", divFormGroup, numberActeurAdd)

      // Ajoutez l'élément div principal à votre élément parent, par exemple le body
      divCreateActeur.appendChild(divFormGroup);
      numberActeurAdd++;
    });

    const modalCreateRealisateurSubmit = document.getElementById(
      "btn-create-realisateur"
    );
    modalCreateRealisateurSubmit.addEventListener("click", function (e) {
      e.preventDefault();
      const formData = new FormData();
      const realisateurInputNom = document.getElementById("input-realisateur-nom");
      const realisateurInputPrenom = document.getElementById("input-realisateur-prenom");
      if(realisateurInputNom.checkValidity() && realisateurInputPrenom.checkValidity())
      formData.append("nom", realisateurInputNom.value);
      formData.append("prenom", realisateurInputPrenom.value);
      fetch("{% url 'create_realisateur_in_film' %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": getCookie("csrftoken"),
        },
        body: formData,
      })
        .then((response) => response.json())
        .then((data) => {
          const newOption = new Option(data.name, data.id, true, true);
          const acteursSelect = document.querySelector('select[name="realisateur"]');
          acteursSelect.append(newOption);
          realisateurInputNom.value ="";
          realisateurInputPrenom.value ="";
          $('#createRealisateurModal').modal('hide');
        });
    });

    

  });

  function createInputPerso(inputName, divFormGroup, numberID){

      let label = document.createElement("label");
      label.setAttribute("for", "acteur_"+inputName+ "_" + numberID);
      label.innerText = "Acteur " + numberID + " " + inputName;

      let input = document.createElement("input");
      input.setAttribute("type", "text");
      input.className = "form-control";
      input.id = "acteur_"+inputName+"_" + numberID;
      input.name = "acteur_"+inputName+"_" + numberID;


      divFormGroup.appendChild(label);
      divFormGroup.appendChild(input);
  }
  
  function getCookie(name) {
    let value = "; " + document.cookie;
    let parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();
  }
</script>
{% endblock %}
