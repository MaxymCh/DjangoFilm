{% extends "lesFilms/base.html" %}
{% block title %}{{ action_name }} {{class_name }}{% endblock %}

{% load static %}
{% block style %}<link rel="stylesheet" href="{% static 'css/style_form_film.css' %}" />{% endblock %}

{% block content %}
<form method="post" class="post-form">
  {% csrf_token %}
  <div class="container container-form">
    <br />
    <div class="form-group row">
      <label class="col-sm-1 col-form-label"></label>
      <div class="col-sm-4">
        <h3>{{ action_description }} {{ class_name }}</h3>
      </div>
    </div>
    {{ form.as_p }}
    <a href="#" data-bs-toggle="modal"
    data-bs-target="#createActeurModal" class="open-createModal">Ajouter Acteur
    </a>

    <div class="form-group row">
      <label class="col-sm-1 col-form-label"></label>
      <div class="col-sm-4">
        <button type="submit" class="btn btn-success">Valider</button>
      </div>
    </div>
  </div>
</form>

<div
  class="modal fade"
  id="createActeurModal"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">
          Création de Realisteur
        </h5>
        <button type="button"  class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="input-acteur-prenom">Prenom</label>
          <input type="text" class="form-control" id="input-acteur-prenom">
        </div>
        <div class="form-group">
          <label for="input-acteur-nom">Nom</label>
          <input type="text" class="form-control" id="input-acteur-nom">
        </div>
      </div>
      <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal">Annuler
          </button>
          <button type="button" class="btn btn-success" id="btn-create-acteur">Crée</button>
      </div>
    </div>
  </div>
</div>  

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const modalCreateActeurSubmit = document.getElementById(
      "btn-create-acteur"
    );
    modalCreateActeurSubmit.addEventListener("click", function (e) {
      e.preventDefault();
      const formData = new FormData();
      const acteurInputNom = document.getElementById("input-acteur-nom");
      const acteurInputPrenom = document.getElementById("input-acteur-prenom");
      if(acteurInputNom.checkValidity() && acteurInputPrenom.checkValidity())
      formData.append("nom", acteurInputNom.value);
      formData.append("prenom", acteurInputPrenom.value);
      fetch("{% url 'create_acteur_in_film' %}", {
        method: "POST",
        headers: {
          "X-CSRFToken": getCookie("csrftoken"),
        },
        body: formData,
      })
        .then((response) => response.json())
        .then((data) => {
          const newOption = new Option(data.name, data.id, true, true);
          const acteursSelect = document.querySelector('select[name="acteurs"]');
          acteursSelect.append(newOption);
          acteurInputNom.value ="";
          acteurInputPrenom.value ="";
          $('#createActeurModal').modal('hide');
        });
    });

    

  });

  function createInputPerso(inputName, divFormGroup, numberID){

      let label = document.createElement("label");
      label.setAttribute("for", "realisateur"+inputName+ "_" + numberID);
      label.innerText = "Realisateur " + numberID + " " + inputName;

      let input = document.createElement("input");
      input.setAttribute("type", "text");
      input.className = "form-control";
      input.id = "realisateur_"+inputName+"_" + numberID;
      input.name = "realisateur_"+inputName+"_" + numberID;


      divFormGroup.appendChild(label);
      divFormGroup.appendChild(input);
  }
  
  function getCookie(name) {
    let value = "; " + document.cookie;
    let parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();
  }
</script>
{% endblock %}
