{% extends "lesFilms/base.html" %}
{% block title %}{{ action_name }} {{class_name }}{% endblock %}

{% load static %}
{% block style %}<link rel="stylesheet" href="{% static 'css/style_form_film.css' %}" />{% endblock %}

{% block content %}
<form method="post" class="post-form">
  {% csrf_token %}
  <div class="container container-form">
    <br />
    <div class="form-group row">
      <label class="col-sm-1 col-form-label"></label>
      <div class="col-sm-4">
        <h3>{{ action_description }} {{ class_name }}</h3>
      </div>
    </div>
    {{ form.as_p }}
    <button type="button" onclick="addActeur()" class="btn btn-primary">Ajouter Acteur</button>
    <div id="Création acteur" hidden>
      {{ acteur_form }}
      <button type="button" onclick="createActeur()">Crée l'Acteur</button>
    </div>

    <div class="form-group row">
      <label class="col-sm-1 col-form-label"></label>
      <div class="col-sm-4">
        <button type="submit" class="btn btn-success">Valider</button>
      </div>
    </div>
  </div>
</form>


<script>
  document.addEventListener("DOMContentLoaded", function () {

  });
  
  function addActeur(){
    const divActeur = document.getElementById("Création acteur");
    divActeur.hidden = false;
  }

  function createActeur(){
    const formData = new FormData();
    const acteurInputNom = document.getElementById("id_nom");
    const acteurInputPrenom = document.getElementById("id_prenom");
    if(acteurInputNom.checkValidity() && acteurInputPrenom.checkValidity())
    formData.append("nom", acteurInputNom.value);
    formData.append("prenom", acteurInputPrenom.value);
    fetch("{% url 'create_acteur_in_film' %}", {
      method: "POST",
      headers: {
        "X-CSRFToken": getCookie("csrftoken"),
      },
      body: formData,
    })
      .then((response) => response.json())
      .then((data) => {
        const newOption = new Option(data.name, data.id, true, true);
        const acteursSelect = document.querySelector('select[name="acteurs"]');
        acteursSelect.append(newOption);
        acteurInputNom.value ="";
        acteurInputPrenom.value ="";
        const divActeur = document.getElementById("Création acteur");
        divActeur.hidden = true;
      });
  }

  function createInputPerso(inputName, divFormGroup, numberID){

      let label = document.createElement("label");
      label.setAttribute("for", "realisateur"+inputName+ "_" + numberID);
      label.innerText = "Realisateur " + numberID + " " + inputName;

      let input = document.createElement("input");
      input.setAttribute("type", "text");
      input.className = "form-control";
      input.id = "realisateur_"+inputName+"_" + numberID;
      input.name = "realisateur_"+inputName+"_" + numberID;


      divFormGroup.appendChild(label);
      divFormGroup.appendChild(input);
  }
  
  function getCookie(name) {
    let value = "; " + document.cookie;
    let parts = value.split("; " + name + "=");
    if (parts.length == 2) return parts.pop().split(";").shift();
  }
</script>
{% endblock %}
